<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="content">
    <div class="right_col" role="main">
        <div class="">
            <div class="clearfix"></div>
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>Product in stocks</h2>
                        <div class="clearfix"></div>
                    </div>

                    <div class="x_content">
                        <div class="container">
                            <div style="display: flex;align-items: flex-end;justify-content: end;">
                                <form id="searchForm" th:action="@{/product-in-stock/list/1}" method="GET" style="display: flex;margin-bottom: 6px;">
                                    <input class="form-control" name="keyword" th:value="${keyword}" style="margin-right: 8px;"/>
                                    <button class="btn btn-success" type="submit">Search</button>
                                </form>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped jambo_table bulk_action">
                                <thead>
                                <tr class="headings">
                                    <th class="column-title"># </th>
                                    <th class="column-title">Category</th>
                                    <th class="column-title">Code</th>
                                    <th class="column-title">Name</th>
                                    <th class="column-title">Qty </th>
                                    <th class="column-title">Price </th>
                                    <th class="column-title">Image </th>
                                </tr>
                                </thead>

                                <tbody>
                                    <tr th:each="product, loop : ${products}" th:class="${loop.index%2==0 } ? 'even pointer' : 'odd pointer'">
                                        <td class=" " th:text="${loop.index + 1 + pageInfo.offset}"></td>
                                        <td class=" " th:text="${product.productInfo.category.name }"></td>
                                        <td class=" " th:text="${product.productInfo.code }"></td>
                                        <td class=" " th:text="${product.productInfo.name }"></td>
                                        <td class=" " th:text="${product.qty }"></td>
                                        <td class="price-invoice" th:text="${product.price }"></td>
                                        <td class=" ">
                                            <img th:src="@{${product.productInfo.imgUrl}}" alt="" width="100px" height="100px">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <th:block th:if="${pageInfo.totalPages > 0}">
                                <div style="display: flex;justify-content: center;align-items: center;">
                                    <span th:if="${pageInfo.totalPages > 1}" class="fa fa-angle-left" style="font-size: 24px;padding: 4px 18px;cursor: pointer;"
                                          th:onclick="|gotoPage(${pageInfo.indexPage} - 1);|"
                                    ></span>
                                    <ul class="pagination"></ul>
                                    <span th:if="${pageInfo.totalPages > 1}" class="fa fa-angle-right" style="font-size: 24px;padding: 4px 18px;cursor: pointer;"
                                          th:onclick="|gotoPage(${pageInfo.indexPage} + 1);|"
                                    ></span>
                                </div>
                            </th:block>
                            <th:block th:unless="${pageInfo.totalPages > 0}">
                                <p style="text-align: center;">No production in stocks</p>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script th:inline="javascript">
        var totalPages = [[${pageInfo.totalPages}]];
        var currentPage = [[${pageInfo.indexPage}]];

        function confirmDelete(id){
            if(confirm('Do you want delete this record?')){
                let urlTemplate = /*[[@{/product-in-stock/delete/{id}(id=${1})}]]*/ '';
                window.location.href = urlTemplate.replace('1', id);
            }
        }
        function gotoPage(page){
            var baseUrl = [[@{/product-in-stock/list/}]];
		    $('#searchForm').attr('action', baseUrl + page);
		    $('#searchForm').submit();
	    }

        $(document).ready(function(){
		    processMessage();
		    renderPagination(currentPage, totalPages);

            $('#product-infolistId').addClass('current-page').siblings()
                    .removeClass('current-page');
            $('#product-infolistId').addClass('active').siblings().removeClass('active');

            $('.price-invoice').each(function(){
                $(this).text(numeral($(this).text()).format('0,0'));
            })

            $('#product-in-stocklistId').addClass('current-page').siblings()
                        .removeClass('current-page');
            var parent = $('#product-in-stocklistId').parents('li');
            parent.addClass('active').siblings().removeClass('active');
            $('#product-in-stocklistId').parents().show();

	    });
        function processMessage(){
            /*<![CDATA[*/
                var msgSuccess = [[${msgSuccess}]];
                var msgError = [[${msgError}]];
            /*]]>*/
            if(msgSuccess){
                new PNotify({
                    title: ' Success',
                    text: msgSuccess,
                    type: 'success',
                    styling: 'bootstrap3'
                });
            }
            if(msgError){
                new PNotify({
                    title: ' Error',
                    text: msgError,
                    type: 'error',
                    styling: 'bootstrap3'
                });
            }
        }

        function renderPagination(currentPage, totalPages) {
            var paginationElement = $('.pagination');
            paginationElement.empty();

            function addPage(page) {
                const pageLi = $('<li>');
                const pageBtn = $('<a>').attr('href', '#').text(page);
                if(page === currentPage) {
                    pageLi.addClass('active');
                } else {
                    pageBtn.on('click', function (e) {
                        e.preventDefault();
                        gotoPage(page);
                    });
                }
                pageLi.append(pageBtn);
                paginationElement.append(pageLi);
            }

            addPage(1);

            if (currentPage > 3) paginationElement.append('<li><span>...</span></li>');

            for (let i = Math.max(2, currentPage - 2); i <= Math.min(totalPages - 1, currentPage + 2); i++) {
                addPage(i);
            }

            if (currentPage < totalPages - 3) paginationElement.append('<li><span>...</span></li>');

            if (totalPages > 1) addPage(totalPages);
        }

    </script>
</div>
</body>
</html>