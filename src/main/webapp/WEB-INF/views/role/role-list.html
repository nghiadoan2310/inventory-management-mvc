<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="content">
    <div class="right_col" role="main">
        <div class="">
            <div class="clearfix"></div>
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>Role List </h2>
                        <div class="clearfix"></div>
                    </div>

                    <div class="x_content">
                        <div class="container">
                            <div style="display: flex;align-items: flex-end;justify-content: space-between;">
                                <a th:href="@{/role/add}" class="btn btn-app"><i class="fa fa-plus"></i>Add</a>
                                <form id="searchForm" th:action="@{/role/list/1}" method="GET" style="display: flex;margin-bottom: 6px;">
                                    <input class="form-control" name="keyword" th:value="${keyword}" style="margin-right: 8px;"/>
                                    <button class="btn btn-success" type="submit">Search</button>
                                </form>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped jambo_table bulk_action">
                                <thead>
                                <tr class="headings">
                                    <th class="column-title"># </th>
                                    <th class="column-title">Name</th>
                                    <th class="column-title">Description </th>
                                    <th class="column-title no-link last text-center" colspan="3"><span class="nobr">Action</span>
                                    </th>
                                </tr>
                                </thead>

                                <tbody>
                                    <tr th:each="role, loop : ${roles}" th:class="${loop.index%2==0 } ? 'even pointer' : 'odd pointer'">
                                        <td class=" " th:text="${loop.index+1+pageInfo.offset}"></td>
                                        <td class=" " th:text="${role.roleName }"></td>
                                        <td class=" " th:text="${role.description }"></td>
                                        <td class="text-center"><a th:href="@{/role/view/{id}(id=${role.id})}" class="btn btn-round btn-default">View</a></td>
                                        <td class="text-center"><a th:href="@{/role/edit/{id}(id=${role.id})}" class="btn btn-round btn-primary">Edit</a></td>
                                        <td class="text-center"><a href="javascript:void(0);" th:onclick="|confirmDelete(${role.id});|" class="btn btn-round btn-danger">Delete</a></td>
                                    </tr>
                                </tbody>
                            </table>

                            <th:block th:if="${pageInfo.totalPages > 0}">
                                <div style="display: flex;justify-content: center;align-items: center;">
                                <span th:if="${pageInfo.totalPages > 1}" class="fa fa-angle-left" style="font-size: 24px;padding: 4px 18px;cursor: pointer;"
                                      th:onclick="|gotoPage(${pageInfo.indexPage} - 1);|"
                                ></span>
                                    <ul class="pagination"></ul>
                                    <span th:if="${pageInfo.totalPages > 1}" class="fa fa-angle-right" style="font-size: 24px;padding: 4px 18px;cursor: pointer;"
                                          th:onclick="|gotoPage(${pageInfo.indexPage} + 1);|"
                                    ></span>
                                </div>
                            </th:block>>
                            <th:block th:unless="${pageInfo.totalPages > 0}">
                                <p style="text-align: center;">Role list empty</p>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script th:inline="javascript">
        var totalPages = [[${pageInfo.totalPages}]];
        var currentPage = [[${pageInfo.indexPage}]];

        function confirmDelete(id){
            if(confirm('Do you want delete this record?')){
                let urlTemplate = /*[[@{/role/delete/{id}(id=${1})}]]*/ '';
                window.location.href = urlTemplate.replace('1', id);
            }
        }
        function gotoPage(page){
            var baseUrl = [[@{/role/list/}]];
		    $('#searchForm').attr('action', baseUrl + page);
		    $('#searchForm').submit();
	    }

        $(document).ready(function(){
		    processMessage();
		    renderPagination(currentPage, totalPages);

		    $('#rolelistId').addClass('current-page').siblings()
                        .removeClass('current-page');
            var parent = $('#rolelistId').parents('li');
            parent.addClass('active').siblings().removeClass('active');
            $('#rolelistId').parents().show();
	    });
        function processMessage(){
            /*<![CDATA[*/
                var msgSuccess = [[${msgSuccess}]];
                var msgError = [[${msgError}]];
            /*]]>*/
            if(msgSuccess){
                new PNotify({
                    title: ' Success',
                    text: msgSuccess,
                    type: 'success',
                    styling: 'bootstrap3'
                });
            }
            if(msgError){
                new PNotify({
                    title: ' Error',
                    text: msgError,
                    type: 'error',
                    styling: 'bootstrap3'
                });
            }
        }

        function renderPagination(currentPage, totalPages) {
            var paginationElement = $('.pagination');
            paginationElement.empty();

            function addPage(page) {
                const pageLi = $('<li>');
                const pageBtn = $('<a>').attr('href', '#').text(page);
                if(page === currentPage) {
                    pageLi.addClass('active');
                } else {
                    pageBtn.on('click', function (e) {
                        e.preventDefault();
                        gotoPage(page);
                    });
                }
                pageLi.append(pageBtn);
                paginationElement.append(pageLi);
            }

            addPage(1);

            if (currentPage > 3) paginationElement.append('<li><span>...</span></li>');

            for (let i = Math.max(2, currentPage - 2); i <= Math.min(totalPages - 1, currentPage + 2); i++) {
                addPage(i);
            }

            if (currentPage < totalPages - 3) paginationElement.append('<li><span>...</span></li>');

            if (totalPages > 1) addPage(totalPages);
        }

    </script>
</div>
</body>
</html>